# Конфигурация Docker Compose (Лабораторная 2)

- **Образ:** `postgres:14`
- **Имя контейнера:** `postgres_service`
- **Переменные окружения:**
  - `POSTGRES_USER`: имя пользователя для доступа к базе данных
  - `POSTGRES_PASSWORD`: пароль для пользователя
  - `POSTGRES_DB`: название БД
- **Тома:**
  - `db_data:/var/lib/postgresql/data`: данные сохраняются в volume для их сохранения после перезапуска контейнера.
- **Healthcheck:**
  - Команда: `pg_isready -U ${POSTGRES_USER}`, проверяет, готов ли сервер к приему запросов.
  - Интервал проверки: 10 секунд
  - Таймаут: 5 секунд
  - Количество повторов: 5


### Инициализация 
Собирается из текущей директории с использованием `Dockerfile`.
- **Имя контейнера:** `init_service`
- **Зависимость:** запускается после `db`
- **Тома:**
  - `.:/shop_api`: монтирует текущую директорию внутрь контейнера по пути `/shop_api`
- **Рабочая директория:** `/shop_api`
- **Переменные окружения:** 
  - Конфигурация аналогична сервису `db`, с добавлением параметров `POSTGRES_HOST` и `POSTGRES_PORT` для подключения к базе
- **Сеть:**`my_network`.
- **Команда запуска:** `python shop_api/init_db.py` — выполняет скрипт инициализации БД

### Сервис `app`

Основной сервис, отвечающий за запуск веб-приложения.
Собирается из текущей директории с использованием `Dockerfile`.
- **Имя контейнера:** `app_service`
- **Healthcheck:**
  - Команда: `curl -f http://localhost/docs` проверяет доступность документации Swagger
  - Интервал проверки: 30 секунд
  - Тайм-аут: 10 секунд
  - Количество попыток: 3
  - `.:/shop_api`: монтирует текущую директорию внутрь контейнера по пути `/shop_api`
- **Рабочая директория:** `/shop_api`
  - Настройки базы данных аналогичны сервису `init`.
Запускается после `db` и `init`.
Также подключен к `my_network`.
- **Команда запуска:** `poetry run uvicorn shop_api.main:app --host 0.0.0.0 --port 80` — запускает приложение с использованием Uvicorn

## Сеть `my_network`

Создается пользовательская сеть с драйвером `bridge` для обеспечения взаимодействия между контейнерами `db`, `init` и `app`.

## Тома

- **db_data:** Обеспечивает постоянное хранение данных для базы данных PostgreSQL. Данные сохраняются на хосте и не удаляются при остановке контейнера.

## Использование

1. Убедитесь, что переменные окружения `POSTGRES_USER`, `POSTGRES_PASSWORD` и `POSTGRES_DB` заданы в вашем окружении или файле `.env`.
2. Запустите контейнеры:
   ```bash
   docker-compose up
